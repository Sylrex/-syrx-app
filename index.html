<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYRX Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a, #10b981);
            color: #fff;
            text-align: center;
            min-height: 100vh;
        }
        .page { display: none; }
        .active { display: block; }
        .logo { width: 100px; margin-bottom: 20px; }
        .user-photo { width: 120px; height: 120px; border-radius: 50%; border: 3px solid #fff; margin-bottom: 15px; }
        button { padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        button:hover { transform: scale(1.05); }
        .wallet-btn { background-color: #f97316; color: #fff; }
        .wallet-btn:hover { background-color: #ea580c; }
        .nav-buttons { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.1); padding: 10px; display: flex; justify-content: space-around; }
        .nav-buttons button { background-color: #6b7280; color: #fff; }
        .nav-buttons button:hover { background-color: #4b5563; }
    </style>
</head>
<body>
    <div id="home" class="page active">
        <img src="/icon.png" class="logo" alt="SYRX Logo">
        <img id="user-photo" class="user-photo" src="" alt="User Photo">
        <h2 id="user-name">Welcome!</h2>
        <p>User ID: <span id="user-id">Loading...</span></p>
        <p>Your Points: <span id="points">0</span></p>
        <p>Wallet Status: <span id="wallet-status">Not Connected</span></p>
        <button class="wallet-btn" id="connect-wallet">Connect TON Wallet</button>
    </div>

    <div class="nav-buttons">
        <button onclick="showPage('home')">Home</button>
    </div>

    <script>
        const WebApp = window.Telegram.WebApp;
        WebApp.ready();

        const user = WebApp.initDataUnsafe.user;
        let userId = user ? user.id : 'guest';
        if (user) {
            document.getElementById('user-name').innerText = `Welcome, ${user.first_name || 'User'}!`;
            document.getElementById('user-id').innerText = userId;
            if (user.photo_url) {
                document.getElementById('user-photo').src = user.photo_url;
            }
        }

        async function fetchPoints() {
            try {
                const response = await fetch(`https://your-backend.onrender.com/api/points/${userId}`);
                const data = await response.json();
                document.getElementById('points').innerText = data.points || 0;
            } catch (error) {
                console.error('Error fetching points:', error);
            }
        }
        fetchPoints();

        const tonConnectUI = new TONConnectUI.TonConnectUI({
            manifestUrl: 'https://your-mini-app.vercel.app/tonconnect-manifest.json',
            buttonRootId: 'connect-wallet'
        });
        tonConnectUI.onStatusChange(walletInfo => {
            const walletStatus = document.getElementById('wallet-status');
            const connectBtn = document.getElementById('connect-wallet');
            if (walletInfo) {
                walletStatus.innerText = `Connected: ${walletInfo.account.address.slice(0, 6)}...${walletInfo.account.address.slice(-4)}`;
                connectBtn.innerText = 'Disconnect Wallet';
                fetch(`https://your-backend.onrender.com/api/wallet/${userId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wallet_address: walletInfo.account.address })
                }).then(() => {
                    WebApp.showAlert('Wallet connected successfully!');
                    fetchPoints();
                });
            } else {
                walletStatus.innerText = 'Not Connected';
                connectBtn.innerText = 'Connect TON Wallet';
            }
        });

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }
    </script>
</body>
    </html>
